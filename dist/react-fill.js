!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("ramda"),require("voca/chars"),require("voca/words"),require("react")):"function"==typeof define&&define.amd?define(["ramda","voca/chars","voca/words","react"],n):"object"==typeof exports?exports.ReactFill=n(require("ramda"),require("voca/chars"),require("voca/words"),require("react")):e.ReactFill=n(e.ramda,e["voca/chars"],e["voca/words"],e.react)}(this,function(__WEBPACK_EXTERNAL_MODULE_0__,__WEBPACK_EXTERNAL_MODULE_3__,__WEBPACK_EXTERNAL_MODULE_4__,__WEBPACK_EXTERNAL_MODULE_2__){return function(e){function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="/dist/",n(n.s=1)}([function(module,exports){eval('module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n//////////////////\n// WEBPACK FOOTER\n// external "ramda"\n// module id = 0\n// module chunks = 0\n\n//# sourceURL=webpack:///external_%22ramda%22?')},function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = __webpack_require__(2);\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _ramda = __webpack_require__(0);\n\nvar _ramda2 = _interopRequireDefault(_ramda);\n\nvar _chars = __webpack_require__(3);\n\nvar _chars2 = _interopRequireDefault(_chars);\n\nvar _words = __webpack_require__(4);\n\nvar _words2 = _interopRequireDefault(_words);\n\nvar _utils = __webpack_require__(5);\n\n__webpack_require__(6);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar ReactFill = function (_React$Component) {\n  _inherits(ReactFill, _React$Component);\n\n  function ReactFill(props) {\n    _classCallCheck(this, ReactFill);\n\n    var _this = _possibleConstructorReturn(this, (ReactFill.__proto__ || Object.getPrototypeOf(ReactFill)).call(this, props));\n\n    _this.updateStateNewText(props);\n    return _this;\n  }\n\n  _createClass(ReactFill, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.refs[this.state.focusKey].focus();\n      this.intervalID = setInterval(function () {\n        try {\n          var nextKey = (0, _utils.findNextKey)(_this2.keys, _this2.state.completeKeys);\n          if (nextKey) {\n            _this2.refs[nextKey].focus();\n          }\n        } catch (e) {\n          clearInterval(_this2.intervalID);\n        }\n      }, 10);\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.text !== this.props.text) {\n        this.updateStateNewText(nextProps);\n      }\n    }\n  }, {\n    key: 'updateStateNewText',\n    value: function updateStateNewText(props) {\n      var tokens = (0, _words2.default)(props.text, /[^\\s]+/g);\n      var nbBlanks = Math.ceil(props.percentBlank * tokens.length);\n      var missingIndexes = (0, _utils.getRandoms)(nbBlanks, tokens.length);\n      var data = _ramda2.default.map(function (idx) {\n        return [idx + '-' + tokens[idx], { original: tokens[idx], value: '' }];\n      }, missingIndexes);\n\n      this.refs = {};\n      this.keys = _ramda2.default.map(function (idx) {\n        return idx + '-' + tokens[idx];\n      }, missingIndexes);\n      this.state = {\n        missingWords: _ramda2.default.fromPairs(data),\n        tokens: tokens,\n        focusKey: _ramda2.default.head(this.keys),\n        completeKeys: [],\n        points: 0,\n        completedWords: [],\n        unCompletedWords: []\n      };\n      this.startTime = new Date().getTime();\n    }\n  }, {\n    key: 'completeWord',\n    value: function completeWord(newPoints, key) {\n      var isAutocomplete = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var completeAction = this.props.completeAction;\n      var _state = this.state,\n          points = _state.points,\n          completeKeys = _state.completeKeys,\n          missingWords = _state.missingWords,\n          tokens = _state.tokens;\n      var _state2 = this.state,\n          completedWords = _state2.completedWords,\n          unCompletedWords = _state2.unCompletedWords;\n\n      var newCompleteKeys = _ramda2.default.union(completeKeys, [key]);\n      var done = !(0, _utils.findNextKey)(this.keys, newCompleteKeys);\n      this.setState({ completeKeys: newCompleteKeys });\n\n      var _key$split = key.split('-'),\n          _key$split2 = _slicedToArray(_key$split, 2),\n          idx = _key$split2[0],\n          word = _key$split2[1];\n\n      if (isAutocomplete) {\n        unCompletedWords = unCompletedWords.concat([{ idx: parseInt(idx, 10), word: word }]);\n      } else {\n        completedWords = completedWords.concat([{ idx: parseInt(idx, 10), word: word }]);\n      }\n      this.setState({ unCompletedWords: unCompletedWords, completedWords: completedWords });\n      if (!done) {\n        this.setState({ points: newPoints });\n      } else {\n        this.endTime = new Date().getTime();\n        completeAction({ duration: this.endTime - this.startTime, points: newPoints }, isAutocomplete, { completedWords: completedWords, unCompletedWords: unCompletedWords, tokens: tokens });\n      }\n    }\n  }, {\n    key: 'handleTab',\n    value: function handleTab(lensState, originalValue, key) {\n      var points = this.state.points;\n\n      var newState = _ramda2.default.set(lensState, originalValue, this.state);\n      this.setState(newState);\n      this.completeWord(points, key, true);\n    }\n  }, {\n    key: 'onChangeAction',\n    value: function onChangeAction(e, key) {\n      var points = this.state.points;\n      var _state$missingWords$k = this.state.missingWords[key],\n          original = _state$missingWords$k.original,\n          value = _state$missingWords$k.value;\n      var _originalChars$valueC = { originalChars: (0, _chars2.default)(original), valueChars: (0, _chars2.default)(value) },\n          originalChars = _originalChars$valueC.originalChars,\n          valueChars = _originalChars$valueC.valueChars;\n\n      var nextWantedChar = originalChars[valueChars.length];\n      var lensState = _ramda2.default.lensPath(['missingWords', key, 'value']);\n      if (e.target.value.toLowerCase() === ('' + value + nextWantedChar).toLowerCase()) {\n        nextWantedChar = (0, _utils.completeWhilePunctuation)(_ramda2.default.takeLast(originalChars.length - (valueChars.length + 1), originalChars));\n        //const nextValue = `${value}${originalChars[valueChars.length]}`\n        var nextValue = '' + value + originalChars[valueChars.length] + nextWantedChar;\n        this.setState(_ramda2.default.set(lensState, nextValue, this.state));\n        if (nextValue === original) {\n          this.completeWord(points + 1, key, false);\n        }\n      }\n    }\n  }, {\n    key: 'onKeyUpAction',\n    value: function onKeyUpAction(e, key) {\n      var keypressAction = this.props.keypressAction;\n      var _state$missingWords$k2 = this.state.missingWords[key],\n          original = _state$missingWords$k2.original,\n          value = _state$missingWords$k2.value;\n\n      var lensState = _ramda2.default.lensPath(['missingWords', key, 'value']);\n      if (e.keyCode === 9 || e.keyCode === 13) {\n        this.handleTab(lensState, original, key);\n        e.preventDefault();\n      }\n      keypressAction(e);\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this3 = this;\n\n      var mapIndex = _ramda2.default.addIndex(_ramda2.default.map);\n      var _state3 = this.state,\n          missingWords = _state3.missingWords,\n          tokens = _state3.tokens;\n\n      if (!missingWords) return null;\n      return _react2.default.createElement(\n        'div',\n        { className: this.props.className },\n        mapIndex(function (token, idx) {\n          var k = idx + '-' + token;\n          if (missingWords[k]) {\n            return _react2.default.createElement(\n              'span',\n              { className: 'missing-word', key: k },\n              _react2.default.createElement('input', {\n                ref: function ref(input) {\n                  return _this3.refs = _ramda2.default.merge(_this3.refs, _defineProperty({}, k, input));\n                },\n                id: k,\n                value: missingWords[k].value,\n                onKeyUp: function onKeyUp(e) {\n                  return _this3.onKeyUpAction(e, k);\n                },\n                onChange: function onChange(e) {\n                  return _this3.onChangeAction(e, k);\n                }\n              }),\n              _react2.default.createElement(\n                'label',\n                { htmlFor: k },\n                mapIndex(function (char, idx) {\n                  var valueChar = (0, _chars2.default)(missingWords[k].value)[idx];\n                  return valueChar || _react2.default.createElement('i', { key: idx, className: 'dot' });\n                }, (0, _chars2.default)(missingWords[k].original))\n              ),\n              '\\xA0'\n            );\n          } else {\n            return token + ' ';\n          }\n        }, tokens)\n      );\n    }\n  }]);\n\n  return ReactFill;\n}(_react2.default.Component);\n\nexports.default = ReactFill;\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/ReactFill.js\n// module id = 1\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/ReactFill.js?")},function(module,exports){eval('module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n//////////////////\n// WEBPACK FOOTER\n// external "react"\n// module id = 2\n// module chunks = 0\n\n//# sourceURL=webpack:///external_%22react%22?')},function(module,exports){eval('module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n//////////////////\n// WEBPACK FOOTER\n// external "voca/chars"\n// module id = 3\n// module chunks = 0\n\n//# sourceURL=webpack:///external_%22voca/chars%22?')},function(module,exports){eval('module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n//////////////////\n// WEBPACK FOOTER\n// external "voca/words"\n// module id = 4\n// module chunks = 0\n\n//# sourceURL=webpack:///external_%22voca/words%22?')},function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.completeWhilePunctuation = exports.isPunctuationChar = exports.findNextKey = exports.getRandoms = undefined;\n\nvar _ramda = __webpack_require__(0);\n\nvar _ramda2 = _interopRequireDefault(_ramda);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar getRandoms = exports.getRandoms = function getRandoms(nbRandoms, end) {\n  var acc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n  var number = Math.floor(Math.random() * end);\n  var foundNumber = _ramda2.default.find(function (n) {\n    return n === number;\n  }, acc);\n  if (nbRandoms === 0) return _ramda2.default.sort(function (a, b) {\n    return a - b;\n  }, acc);\n  if (foundNumber === undefined) return getRandoms(nbRandoms - 1, end, _ramda2.default.union(acc, [number]));\n  return getRandoms(nbRandoms, end, acc);\n};\n\nvar findNextKey = exports.findNextKey = function findNextKey(allKeys, completeKeys) {\n  var differenceWithCompleteKeys = _ramda2.default.difference(allKeys, completeKeys);\n  if (differenceWithCompleteKeys.length === 0) return null;\n  var nextKeyIdx = _ramda2.default.lastIndexOf(_ramda2.default.last(completeKeys), allKeys) + 1;\n  var nextKey = allKeys[nextKeyIdx];\n  if (!nextKey && differenceWithCompleteKeys.length > 0) {\n    return allKeys[0];\n  }\n  return nextKey;\n};\n\nvar isPunctuationChar = exports.isPunctuationChar = function isPunctuationChar(char) {\n  var reg = /,|\\.|!|\\?|\\\"/;\n  return reg.test(char);\n};\n\nvar completeWhilePunctuation = exports.completeWhilePunctuation = function completeWhilePunctuation(nextTokens) {\n  var str = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n  var nextToken = nextTokens[0];\n  if (!isPunctuationChar(nextToken)) return str;\n  return completeWhilePunctuation(_ramda2.default.takeLast(nextTokens.length - 1, nextTokens), '' + str + nextToken);\n};\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/utils.js\n// module id = 5\n// module chunks = 0\n\n//# sourceURL=webpack:///./src/utils.js?")},function(module,exports){eval("// removed by extract-text-webpack-plugin\n\n//////////////////\n// WEBPACK FOOTER\n// ./scss/style.scss\n// module id = 6\n// module chunks = 0\n\n//# sourceURL=webpack:///./scss/style.scss?")}])});